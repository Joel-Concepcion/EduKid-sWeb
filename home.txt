import React, { useState, useEffect } from 'react';
import { useNavigate } from "react-router-dom";
import { getAuth } from "firebase/auth";
import { getFirestore, collection, getDocs, query, where } from "firebase/firestore";
import appFirebase from "../model/db";

// Importar componentes existentes (ajusta las rutas según tu estructura)
import RegistroAlumnos from '../components/RegistroAlumnos'; // Tu componente de React Native convertido
import AjustesPerfil from '../components/AjustesPerfil'; // Tu componente de ajustes
import ActividadMatematica from '../components/ActividadMatematica'; // Tu componente de matemáticas

// Importar las imágenes directamente
import banner18 from '../assets/bannerClase/Rectangle 18.png';
import banner19 from '../assets/bannerClase/Rectangle 19.png';
import banner20 from '../assets/bannerClase/Rectangle 20.png';
import banner21 from '../assets/bannerClase/Rectangle 21.png';
import banner22 from '../assets/bannerClase/Rectangle 22.png';

// Importar otras imágenes
import professorImg from '../assets/bannerClase/img profesor.png';
import mateIcon from '../assets/icon/mate.png';
import liteIcon from '../assets/icon/lite.png';
import figuIcon from '../assets/icon/figu.png';
import sonidoIcon from '../assets/icon/sonido.png';
import quizzIcon from '../assets/icon/quizz.png';
import ajus from '../assets/icon/ajus.png';
import home from '../assets/icon/home.png';
import regis from '../assets/icon/regis.png';
import iaIcon from '../../src/assets/IA (2).png';

import styles from'../styles/home/home.module.css';

const db = getFirestore(appFirebase);
const auth = getAuth();

const bannerMap = {
    'Rectangle18.png': banner18,
    'Rectangle19.png': banner19,
    'Rectangle20.png': banner20,
    'Rectangle21.png': banner21,
    'Rectangle22.png': banner22,
};

function Home() {
    const navigate = useNavigate();
    const [clases, setClases] = useState([]);
    const [seccionActiva, setSeccionActiva] = useState('home');
    const [subseccionActiva, setSubseccionActiva] = useState('clases');

    // Definición de todas las actividades/secciones
    const activities = [
        {
            id: 'home',
            name: 'Hogar',
            icon: home,
            tipo: 'navegacion'
        },
        {
            id: 'registro',
            name: 'Registro',
            icon: regis,
            tipo: 'navegacion'
        },
        {
            id: 'math',
            name: 'Matemáticas',
            icon: mateIcon,
            tipo: 'actividad'
        },
        {
            id: 'literature',
            name: 'Literatura',
            icon: liteIcon,
            tipo: 'actividad'
        },
        {
            id: 'figures',
            name: 'Figuras',
            icon: figuIcon,
            tipo: 'actividad'
        },
        {
            id: 'sounds',
            name: 'Sonidos',
            icon: sonidoIcon,
            tipo: 'actividad'
        },
        {
            id: 'quizzes',
            name: 'Mini-quizzes',
            icon: quizzIcon,
            tipo: 'actividad'
        },
        {
            id: 'ajustes',
            name: 'Ajustes',
            icon: ajus,
            tipo: 'navegacion'
        }
    ];

    const handleCardClick = (activity) => {
        if (activity.tipo === 'navegacion') {
            setSeccionActiva(activity.id);
            setSubseccionActiva('clases');
        } else {
            setSeccionActiva('home');
            setSubseccionActiva(activity.id);
        }
    };

    // Obtener clases del docente
    useEffect(() => {
        const obtenerClases = async () => {
            try {
                const usuario = auth.currentUser;
                if (!usuario) {
                    console.log("No hay usuario autenticado");
                    return;
                }

                const clasesRef = collection(db, "clases");
                const consulta = query(clasesRef, where("docenteId", "==", usuario.uid));
                const resultado = await getDocs(consulta);

                const clasesUsuario = resultado.docs.map(doc => ({
                    id: doc.id,
                    ...doc.data()
                }));

                console.log("Clases obtenidas:", clasesUsuario);
                setClases(clasesUsuario);
            } catch (error) {
                console.error("Error al obtener clases:", error);
            }
        };

        obtenerClases();
    }, []);

    // Renderizar contenido de actividades académicas
    const renderActividadAcademica = () => {
        switch (subseccionActiva) {
            case 'math':
                return <ActividadMatematica />;
            case 'literature':
                return (
                    <div className={styles.actividadContent}>
                        <h2>Literatura</h2>
                        <div className={styles.actividadGrid}>
                            <div className={styles.actividadItem}>Lectura Básica</div>
                            <div className={styles.actividadItem}>Comprensión Lectora</div>
                            <div className={styles.actividadItem}>Vocabulario</div>
                            <div className={styles.actividadItem}>Ortografía</div>
                        </div>
                    </div>
                );
            case 'figures':
                return (
                    <div className={styles.actividadContent}>
                        <h2>Figuras Geométricas</h2>
                        <div className={styles.actividadGrid}>
                            <div className={styles.actividadItem}>Círculos</div>
                            <div className={styles.actividadItem}>Cuadrados</div>
                            <div className={styles.actividadItem}>Triángulos</div>
                            <div className={styles.actividadItem}>Figuras 3D</div>
                        </div>
                    </div>
                );
            case 'sounds':
                return (
                    <div className={styles.actividadContent}>
                        <h2>Sonidos y Fonética</h2>
                        <div className={styles.actividadGrid}>
                            <div className={styles.actividadItem}>Vocales</div>
                            <div className={styles.actividadItem}>Consonantes</div>
                            <div className={styles.actividadItem}>Sílabas</div>
                            <div className={styles.actividadItem}>Palabras Completas</div>
                        </div>
                    </div>
                );
            case 'quizzes':
                return (
                    <div className={styles.actividadContent}>
                        <h2>Mini-quizzes</h2>
                        <div className={styles.actividadGrid}>
                            <div className={styles.actividadItem}>Quiz de Matemáticas</div>
                            <div className={styles.actividadItem}>Quiz de Español</div>
                            <div className={styles.actividadItem}>Quiz de Ciencias</div>
                            <div className={styles.actividadItem}>Quiz General</div>
                        </div>
                    </div>
                );
            case 'clases':
            default:
                return (
                    <div className={styles.clasesSection}>
                        <h2 className={styles.sectionTitle}>Clases:</h2>
                        <div className={styles.classesScroll}>
                            {clases.length > 0 ? (
                                clases.map((clase) => (
                                    <div key={clase.id} className={styles.classCard}>
                                        <div
                                            className={styles.classBannerContainer}
                                            onClick={() => navigate(`/clase/${clase.id}`, { state: { clase } })}
                                        >
                                            <img
                                                src={bannerMap[clase.banner]}
                                                alt={`Banner ${clase.nombreClase}`}
                                                className={styles.classBanner}
                                            />
                                            <h3 className={styles.className}>Clase: {clase.nombreClase}</h3>
                                        </div>
                                    </div>
                                ))
                            ) : (
                                <p className={styles.noClasses}>No hay clases creadas</p>
                            )}
                        </div>
                    </div>
                );
        }
    };

    // Renderizar contenido principal según sección activa
    const renderContenidoPrincipal = () => {
        switch (seccionActiva) {
            case 'home':
                return renderActividadAcademica();
            case 'registro':
                return <RegistroAlumnos />;
            case 'ajustes':
                return <AjustesPerfil />;
            default:
                return renderActividadAcademica();
        }
    };

    return (
        <div className={styles.container1}>
            <div className={styles.containerS}>
                {/* Header común para todas las vistas */}
                <div className={styles.headerSection}>
                    <img
                        src={professorImg}
                        alt="Profesor"
                        className={styles.professorImage}
                    />
                    <h1 className={styles.greeting}>
                        {seccionActiva === 'home' 
                            ? (subseccionActiva === 'clases' 
                                ? 'Hola, Profesor/a' 
                                : activities.find(a => a.id === subseccionActiva)?.name)
                            : seccionActiva === 'registro'
                            ? 'Registro de Estudiantes'
                            : 'Ajustes y Configuración'
                        }
                    </h1>
                    <button
                        onClick={() => navigate('/crear-clase')}
                        className={styles.createClassBtn}
                    >
                        Crear clase
                    </button>
                </div>

                {/* Contenedor principal de dos columnas */}
                <div className={styles.mainContainer}>
                    {/* Barra de navegación lateral */}
                    <nav className={styles.activitiesSection}>
                        <h2 className={styles.sectionTitle}>Navegación</h2>
                        <div className={styles.activitiesGrid}>
                            {activities.map((activity) => (
                                <div
                                    key={activity.id}
                                    className={`${styles.activityCard} ${
                                        (activity.tipo === 'navegacion' && seccionActiva === activity.id) ||
                                        (activity.tipo === 'actividad' && subseccionActiva === activity.id)
                                            ? styles.navActive : ''
                                    }`}
                                    onClick={() => handleCardClick(activity)}
                                >
                                    <div className={styles.cardContent}>
                                        <img
                                            src={activity.icon}
                                            alt={activity.name}
                                            className={styles.activityIcon}
                                        />
                                        <span className={styles.activityText}>{activity.name}</span>
                                    </div>
                                </div>
                            ))}
                        </div>
                    </nav>

                    {/* Contenido principal */}
                    <div className={styles.mainContent}>
                        {renderContenidoPrincipal()}
                    </div>
                </div>

                {/* Botón IA */}
                <button
                    className={styles.aiButton}
                    onClick={() => navigate("/ia")}
                >
                    <img
                        src={iaIcon}
                        alt="IA"
                        className={styles.aiIcon}
                    />
                </button>
            </div>
        </div>
    );
}

export default Home;